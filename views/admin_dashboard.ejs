<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin | Dashboard</title>

  <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/admin_dashboard.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script src="/js/admin_dashboard.js" defer></script>
  <script src="/js/admin_common.js" defer></script>


</head>

<body>

  <div class="wrapper ">
    <aside id="sidebar">
      <div class="d-flex">
        <button id="toggle-btn" class="toggle-btn" type="button">
          <i class="lni lni-grid-alt"></i>
        </button>
        <div class="sidebar-logo">
          <a href="/admin/dashboard">ReadBy</a>
        </div>
      </div>
      <ul class="sidebar-nav">
        <li class="sidebar-item">
          <a href="/admin/dashboard" class="sidebar-link">
            <i class="bi bi-house-door-fill"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="/admin/customers" class="sidebar-link">
            <i class="bi bi-person-fill"></i>
            <span>Customers</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="/admin/products" class="sidebar-link">
            <i class="bi bi-book"></i>
            <span>Products</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="/admin/orders" class="sidebar-link">
            <i class="bi bi-box2-heart-fill"></i>
            <span>Orders</span>
          </a>
        </li>

        <li class="sidebar-item">
          <a href="/admin/categories" class="sidebar-link">
            <i class="bi bi-tags-fill"></i>
            <span>Categories</span>
          </a>
        </li>

        <li class="sidebar-item">
          <a href="/admin/authors" class="sidebar-link">
            <i class="bi bi-vector-pen"></i>
            <span>Authors</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="/admin/publishers" class="sidebar-link">
            <i class="bi bi-journal-arrow-up"></i>
            <span>Publishers</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="/admin/coupons" class="sidebar-link">
            <i class="bi bi-percent"></i>
            <span>Coupons</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="/admin/banners" class="sidebar-link">
            <i class="bi bi-badge-ad-fill"></i>
            <span>Banners</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="/admin/payments" class="sidebar-link">
            <i class="bi bi-cash-coin"></i>
            <span>Payments</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="/admin/settings" class="sidebar-link">
            <i class="bi bi-gear-fill"></i>
            <span>Settings</span>
          </a>
        </li>
      </ul>
      <div class="sidebar-footer">
        <a style="cursor: pointer;" class="sidebar-link" id="logout_link">
          <i class="bi bi-box-arrow-left"></i>
          <span>Logout</span>
        </a>
      </div>
    </aside>


    <div class="main">

      <div class="nav_section  d-flex justify-content-end" style="height: 70px;background-color: #0e2238;">
        <div class="col-2  d-flex justify-content-evenly align-items-center">

          <div class="notification-bg ">
            <i class="bi text-light fs-2 bi-bell-fill"></i>
            <div class="count-bg d-flex align-items-center justify-content-center">

              <span class="fw-bold" style="font-size: small;">4</span>

            </div>


          </div>

          <div class="pfp-bg d-flex align-items-center ">

            <img src="/images/NO PFP.jpg" width="55" style="border-radius: 50%;" height="55" alt="">

          </div>


        </div>


      </div>

      <div id="dashboard_content" class=" p-4 " style="height: 91vh; overflow-y: scroll;">

        <div class="row">

          <div class="col-3 px-3">
            <div class="p-3" style="background-color: bisque; border-radius: 10px;">
              <h6>Total Sales</h6>

              <p class="fs-2 fw-bold">
                <%= totalSales %>
              </p>

            </div>


          </div>

          <div class="col-3 px-3">
            <div class="p-3" style="background-color: bisque; border-radius: 10px;">
              <h6>Total Income</h6>

              <p class="fs-2 fw-bold">₹<%= totalIncome %>
              </p>

            </div>


          </div>

          <div class="col-3 px-3">
            <div class="p-3" style="background-color: bisque; border-radius: 10px;">
              <h6>Total Books</h6>

              <p class="fs-2 fw-bold">
                <%= totalProducts %>
              </p>

            </div>


          </div>

          <div class="col-3 px-3">
            <div class="p-3" style="background-color: bisque; border-radius: 10px;">
              <h6>Total Customers</h6>

              <p class="fs-2 fw-bold">
                <%= totalCustomers %>
              </p>

            </div>


          </div>






        </div>





        <h3 class="my-5">Sales over the year</h3>

        <canvas class="px-5" id="lineChart" height="475"></canvas>



        <h3 class=" my-5 text-center">Best Selling Products</h3>

        <div class="px-5">

        <table class="table">
          <thead>
            <tr class="">
              <th scope="col">#</th>
              <th scope="col">Product</th>
              <th scope="col">Orders</th>
              <th scope="col">Status</th>
              <th scope="col">Price</th>

            </tr>
          </thead>
          <tbody >
            <% bestSelling.forEach((product,index)=> {
              %>


              <% let sum=0; product.stock.forEach(function(subStock) { subStock.forEach(function(quantity) { sum
                +=quantity; }); }); %>

                <% const basePrices=Array.from(product.basePrice.values()); %>
                  <% const lowestBase=Math.min(...basePrices); %>
                    <% const highestBase=Math.max(...basePrices); %>

                      <% const salePrices=Array.from(product.salePrice.values()); %>
                        <% const lowestSale=Math.min(...salePrices); %>
                          <% const highestSale=Math.max(...salePrices); %>

                <tr>
                  
                  <td class="">
                    <%= index+1 %>
                  </td>
                  <td>
                    <%= product.title %>
                  </td>
                  <td>
                    <%= product.totalOrders %>
                  </td>
                  <% if (sum < 5){ %>
                    <td class="db__status db__status--orange">Low in Stock</td>

                    <% }else if(sum===0) {%>
                      

                      <td class="db__status db__status--red">Out of Stock</td>
                      <% }else if(sum >0) {%>

                        <td class="db__status db__status--green">In Stock</td>


                        

                        <% } %>
                        <td><% if (lowestSale===highestSale) { %>


                          <span class="fw-bold me-2">₹<%= lowestSale %>
                          </span>
                          <% }else { %>
                            <span class="fw-bold me-2">₹<%= lowestSale %>-<%= highestSale %> </span>


                            <% } %>


                              </td>
                </tr>
                <% }); %>


          </tbody>

        </table>
      </div>









        <div class="d-flex justify-content-evenly mt-5">
          <div class="d-flex flex-column align-items-center">
            <h3 class="my-5 ">Payments</h3>
            <canvas class="col-6" id="doughnutChart" height="475"></canvas>
          </div>

          <div class="d-flex flex-column align-items-center">
            <h3 class="my-5">Format-Sales Analytics</h3>

            <canvas class="col-6" id="popularFormatChartCanvas" height="475"></canvas>
          </div>

        </div>








      </div>







    </div>

  </div>
  </div>


</body>

</html>